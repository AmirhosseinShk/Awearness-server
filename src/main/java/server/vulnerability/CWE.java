package server.vulnerability;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;


public class CWE {

    public int id;
    public String name;
    public String description;
    public String abstraction;

    /**
     * Add the CWE to the database
     *
     * @param conn the database connection
     * @throws java.sql.SQLException
     */
    public void saveToDatabase(Connection conn) throws SQLException {
        if (!this.inDatabase(conn)) { //This vulnerability is not yet in the DB, so we had it
            PreparedStatement pstmt = conn.prepareStatement("INSERT INTO cwe(name,description,abstraction) VALUES(?,?,?)");
            pstmt.setString(1, name);
            pstmt.setString(2, description);
            pstmt.setString(3, abstraction);
            pstmt.execute();
            ResultSet resultSetId = pstmt.getGeneratedKeys();
            id = resultSetId.getInt(1);
            resultSetId.close();
        }
    }

    public boolean inDatabase(Connection conn) throws SQLException {
        PreparedStatement pstmt = conn.prepareStatement("SELECT id FROM cwe WHERE id LIKE ?");
        pstmt.setInt(1, this.id);
        pstmt.execute();
        ResultSet res = pstmt.getResultSet();
        boolean result = res.next();
        if (result) { //This CPE is already in the DB
            //We get the id of this CPE
            id = res.getInt(1);
        }
        pstmt.close();
        res.close();
        return result;
    }

}
